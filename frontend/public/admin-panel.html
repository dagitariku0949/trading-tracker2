<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Trading Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0f172a;
            color: white;
        }
    </style>
</head>
<body>
    <div id="admin-root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function AdminPanel() {
            const [learningContent, setLearningContent] = useState({
                courses: [],
                videos: [],
                liveStreams: [],
                resources: []
            });
            const [users, setUsers] = useState([]);
            const [trades, setTrades] = useState([]);
            const [activeTab, setActiveTab] = useState('overview');
            const [logs, setLogs] = useState([]);

            useEffect(() => {
                loadData();
            }, []);

            const loadData = async () => {
                try {
                    // Load learning content
                    const learningResponse = await axios.get('/api/learning');
                    if (learningResponse.data.success) {
                        setLearningContent(learningResponse.data.data);
                    }

                    // Load trades
                    const tradesResponse = await axios.get('/api/trades');
                    setTrades(tradesResponse.data || []);

                    // Mock users data
                    setUsers([
                        { id: 1, name: 'Demo Trader', email: 'demo@example.com', createdAt: '2024-01-15', lastLogin: '2024-12-10' }
                    ]);

                    addLog('Admin panel loaded successfully', 'success');
                } catch (error) {
                    console.error('Failed to load data:', error);
                    addLog('Failed to load some data: ' + error.message, 'error');
                    
                    // Fallback data
                    setLearningContent({
                        courses: [
                            {
                                id: 1,
                                title: "Complete Forex Trading Mastery",
                                description: "Master the fundamentals of forex trading",
                                status: "Published",
                                students: 156,
                                lessons: 24,
                                duration: "12 hours"
                            }
                        ],
                        videos: [],
                        liveStreams: [],
                        resources: []
                    });
                }
            };

            const addLog = (message, type = 'info') => {
                const newLog = {
                    id: Date.now(),
                    timestamp: new Date().toLocaleTimeString(),
                    message,
                    type
                };
                setLogs(prev => [newLog, ...prev.slice(0, 49)]);
            };

            const toggleCourseStatus = async (courseId, currentStatus) => {
                const newStatus = currentStatus === 'Published' ? 'Draft' : 'Published';
                try {
                    const response = await axios.put('/api/learning', {
                        type: 'course',
                        id: courseId,
                        updates: { status: newStatus }
                    });
                    
                    if (response.data.success) {
                        await loadData();
                        addLog(`Course ${newStatus.toLowerCase()} successfully!`, 'success');
                    }
                } catch (error) {
                    addLog('Failed to update course: ' + error.message, 'error');
                }
            };

            const deleteCourse = async (courseId) => {
                if (!confirm('Are you sure you want to delete this course?')) return;
                
                try {
                    const response = await axios.delete(`/api/learning?type=course&id=${courseId}`);
                    
                    if (response.data.success) {
                        await loadData();
                        addLog('Course deleted successfully!', 'success');
                    }
                } catch (error) {
                    addLog('Failed to delete course: ' + error.message, 'error');
                }
            };

            return (
                <div className="min-h-screen bg-slate-900 text-white">
                    {/* Header */}
                    <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-2 text-center">
                        üéõÔ∏è ADMIN PANEL: Direct access system management
                    </div>

                    <div className="max-w-7xl mx-auto p-6">
                        <div className="flex items-center justify-between mb-6">
                            <div>
                                <h1 className="text-3xl font-bold text-blue-400 flex items-center">
                                    üëë Admin Panel
                                </h1>
                                <p className="text-gray-400">System management and monitoring</p>
                            </div>
                            <div className="flex gap-3">
                                <button
                                    onClick={() => window.location.href = '/'}
                                    className="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors"
                                >
                                    üè† Back to Dashboard
                                </button>
                            </div>
                        </div>

                        {/* Tab Navigation */}
                        <div className="flex gap-4 mb-6 border-b border-gray-700">
                            {['overview', 'learning', 'trades', 'users', 'logs'].map(tab => (
                                <button
                                    key={tab}
                                    onClick={() => setActiveTab(tab)}
                                    className={`px-4 py-2 font-semibold capitalize ${
                                        activeTab === tab
                                            ? 'text-blue-400 border-b-2 border-blue-400'
                                            : 'text-gray-400 hover:text-white'
                                    }`}
                                >
                                    {tab}
                                </button>
                            ))}
                        </div>

                        {/* Overview Tab */}
                        {activeTab === 'overview' && (
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                                <div className="bg-gray-800 p-6 rounded-lg">
                                    <div className="flex items-center space-x-3 mb-2">
                                        <div className="bg-blue-600 p-2 rounded">üìö</div>
                                        <div>
                                            <p className="text-gray-400 text-sm">TOTAL COURSES</p>
                                            <p className="text-2xl font-bold">{learningContent.courses.length}</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-gray-800 p-6 rounded-lg">
                                    <div className="flex items-center space-x-3 mb-2">
                                        <div className="bg-green-600 p-2 rounded">üìä</div>
                                        <div>
                                            <p className="text-gray-400 text-sm">TOTAL TRADES</p>
                                            <p className="text-2xl font-bold">{trades.length}</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-gray-800 p-6 rounded-lg">
                                    <div className="flex items-center space-x-3 mb-2">
                                        <div className="bg-purple-600 p-2 rounded">üë•</div>
                                        <div>
                                            <p className="text-gray-400 text-sm">TOTAL USERS</p>
                                            <p className="text-2xl font-bold">{users.length}</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-gray-800 p-6 rounded-lg">
                                    <div className="flex items-center space-x-3 mb-2">
                                        <div className="bg-yellow-600 p-2 rounded">üé•</div>
                                        <div>
                                            <p className="text-gray-400 text-sm">TOTAL VIDEOS</p>
                                            <p className="text-2xl font-bold">{learningContent.videos.length}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Learning Content Tab */}
                        {activeTab === 'learning' && (
                            <div className="bg-gray-800 rounded-lg p-6">
                                <h2 className="text-xl font-bold mb-4">üìö Learning Content Management</h2>
                                
                                <div className="space-y-4">
                                    {learningContent.courses.map(course => (
                                        <div key={course.id} className="bg-gray-700 p-4 rounded-lg flex items-center justify-between">
                                            <div>
                                                <h3 className="font-semibold text-lg">{course.title}</h3>
                                                <p className="text-gray-400 text-sm">{course.description}</p>
                                                <div className="flex gap-4 mt-2 text-sm text-gray-300">
                                                    <span>Status: <span className={course.status === 'Published' ? 'text-green-400' : 'text-yellow-400'}>{course.status}</span></span>
                                                    <span>Students: {course.students}</span>
                                                    <span>Lessons: {course.lessons}</span>
                                                    <span>Duration: {course.duration}</span>
                                                </div>
                                            </div>
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={() => toggleCourseStatus(course.id, course.status)}
                                                    className={`px-3 py-1 rounded text-sm font-semibold ${
                                                        course.status === 'Published'
                                                            ? 'bg-yellow-600 hover:bg-yellow-700'
                                                            : 'bg-green-600 hover:bg-green-700'
                                                    }`}
                                                >
                                                    {course.status === 'Published' ? 'Unpublish' : 'Publish'}
                                                </button>
                                                <button
                                                    onClick={() => deleteCourse(course.id)}
                                                    className="px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm font-semibold"
                                                >
                                                    Delete
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Trades Tab */}
                        {activeTab === 'trades' && (
                            <div className="bg-gray-800 rounded-lg p-6">
                                <h2 className="text-xl font-bold mb-4">üìä Trading Data</h2>
                                
                                {trades.length === 0 ? (
                                    <div className="text-center py-8 text-gray-400">
                                        <div className="text-4xl mb-4">üìä</div>
                                        <p>No trades found</p>
                                    </div>
                                ) : (
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left">
                                            <thead>
                                                <tr className="border-b border-gray-700">
                                                    <th className="pb-3 text-gray-400">Symbol</th>
                                                    <th className="pb-3 text-gray-400">Direction</th>
                                                    <th className="pb-3 text-gray-400">Entry</th>
                                                    <th className="pb-3 text-gray-400">Exit</th>
                                                    <th className="pb-3 text-gray-400">P&L</th>
                                                    <th className="pb-3 text-gray-400">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {trades.slice(0, 10).map(trade => (
                                                    <tr key={trade.id} className="border-b border-gray-700">
                                                        <td className="py-3 text-white font-medium">{trade.symbol}</td>
                                                        <td className="py-3">
                                                            <span className={`px-2 py-1 rounded text-xs ${
                                                                trade.direction === 'LONG' ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'
                                                            }`}>
                                                                {trade.direction}
                                                            </span>
                                                        </td>
                                                        <td className="py-3 text-gray-300">{trade.entry_price}</td>
                                                        <td className="py-3 text-gray-300">{trade.exit_price || 'Open'}</td>
                                                        <td className="py-3">
                                                            <span className={`font-bold ${
                                                                (trade.pnl || 0) >= 0 ? 'text-green-400' : 'text-red-400'
                                                            }`}>
                                                                ${trade.pnl || 0}
                                                            </span>
                                                        </td>
                                                        <td className="py-3 text-gray-300">{trade.status || 'OPEN'}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Users Tab */}
                        {activeTab === 'users' && (
                            <div className="bg-gray-800 rounded-lg p-6">
                                <h2 className="text-xl font-bold mb-4">üë• User Management</h2>
                                
                                <div className="overflow-x-auto">
                                    <table className="w-full text-left">
                                        <thead>
                                            <tr className="border-b border-gray-700">
                                                <th className="pb-3 text-gray-400">ID</th>
                                                <th className="pb-3 text-gray-400">Name</th>
                                                <th className="pb-3 text-gray-400">Email</th>
                                                <th className="pb-3 text-gray-400">Registered</th>
                                                <th className="pb-3 text-gray-400">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {users.map(user => (
                                                <tr key={user.id} className="border-b border-gray-700">
                                                    <td className="py-3 text-gray-300">#{user.id}</td>
                                                    <td className="py-3 text-white font-medium">{user.name}</td>
                                                    <td className="py-3 text-gray-300">{user.email}</td>
                                                    <td className="py-3 text-gray-300">{user.createdAt}</td>
                                                    <td className="py-3">
                                                        <span className="bg-green-900 text-green-300 px-2 py-1 rounded text-sm">
                                                            Active
                                                        </span>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* Logs Tab */}
                        {activeTab === 'logs' && (
                            <div className="bg-gray-800 rounded-lg p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold">üìã System Logs</h2>
                                    <button
                                        onClick={() => setLogs([])}
                                        className="bg-red-600 hover:bg-red-700 px-4 py-2 rounded transition-colors"
                                    >
                                        Clear Logs
                                    </button>
                                </div>
                                <div className="bg-black p-4 rounded-lg h-96 overflow-y-auto font-mono text-sm">
                                    {logs.length === 0 ? (
                                        <div className="text-gray-500">No logs available</div>
                                    ) : (
                                        logs.map(log => (
                                            <div key={log.id} className={`mb-1 ${
                                                log.type === 'error' ? 'text-red-400' :
                                                log.type === 'warning' ? 'text-yellow-400' :
                                                log.type === 'success' ? 'text-green-400' : 'text-gray-300'
                                            }`}>
                                                [{log.timestamp}] {log.message}
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<AdminPanel />, document.getElementById('admin-root'));
    </script>
</body>
</html>