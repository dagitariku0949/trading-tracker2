<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Trading Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0f172a;
            color: white;
        }
    </style>
</head>
<body>
    <div id="admin-root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Learning Context Provider
        function LearningProvider({ children }) {
            const [learningContent, setLearningContent] = useState({
                courses: [],
                videos: [],
                liveStreams: [],
                resources: []
            });
            const [loading, setLoading] = useState(true);

            const loadLearningContent = async () => {
                try {
                    setLoading(true);
                    const response = await axios.get('/api/learning');
                    if (response.data.success) {
                        setLearningContent(response.data.data);
                    }
                } catch (error) {
                    console.error('Failed to load learning content:', error);
                    // Fallback data
                    setLearningContent({
                        courses: [
                            {
                                id: 1,
                                title: "Complete Forex Trading Mastery",
                                description: "Master the fundamentals of forex trading",
                                status: "Published",
                                students: 156,
                                lessons: 24,
                                duration: "12 hours"
                            },
                            {
                                id: 2,
                                title: "Advanced Price Action Strategies",
                                description: "Learn professional price action techniques",
                                status: "Published",
                                students: 89,
                                lessons: 16,
                                duration: "8 hours"
                            },
                            {
                                id: 3,
                                title: "Trading Psychology Mastery",
                                description: "Develop mental discipline for trading",
                                status: "Published",
                                students: 67,
                                lessons: 12,
                                duration: "6 hours"
                            }
                        ],
                        videos: [],
                        liveStreams: [],
                        resources: []
                    });
                } finally {
                    setLoading(false);
                }
            };

            const updateContent = async (type, id, updates) => {
                try {
                    await axios.put('/api/learning', {
                        type,
                        id,
                        updates
                    });
                    await loadLearningContent();
                } catch (error) {
                    console.error('Failed to update content:', error);
                }
            };

            const deleteContent = async (type, id) => {
                try {
                    await axios.delete(`/api/learning?type=${type}&id=${id}`);
                    await loadLearningContent();
                } catch (error) {
                    console.error('Failed to delete content:', error);
                }
            };

            useEffect(() => {
                loadLearningContent();
            }, []);

            const value = {
                learningContent,
                loading,
                updateContent,
                deleteContent,
                refreshContent: loadLearningContent
            };

            return React.createElement(
                React.Fragment,
                null,
                children
            );
        }

        // Full Admin Panel Component
        function FullAdminPanel() {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [credentials, setCredentials] = useState({
                username: '',
                password: '',
                ownerKey: ''
            });
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [learningContent, setLearningContent] = useState({
                courses: [],
                videos: [],
                liveStreams: [],
                resources: []
            });
            const [users, setUsers] = useState([]);
            const [activeTab, setActiveTab] = useState('overview');

            // Check if already authenticated
            useEffect(() => {
                const token = sessionStorage.getItem('ownerAuthToken');
                if (token) {
                    setIsAuthenticated(true);
                    loadData();
                }
            }, []);

            const loadData = async () => {
                try {
                    // Load learning content
                    const learningResponse = await axios.get('/api/learning');
                    if (learningResponse.data.success) {
                        setLearningContent(learningResponse.data.data);
                    }

                    // Load users (mock data for now)
                    setUsers([
                        { id: 1, name: 'John Doe', email: 'john@example.com', createdAt: '2024-01-15', lastLogin: '2024-12-10' },
                        { id: 2, name: 'Jane Smith', email: 'jane@example.com', createdAt: '2024-02-20', lastLogin: '2024-12-09' }
                    ]);
                } catch (error) {
                    console.error('Failed to load data:', error);
                }
            };

            const handleLogin = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');

                // Owner credentials
                const OWNER_CREDENTIALS = {
                    username: 'owner',
                    password: 'TradingDashboard2024!',
                    ownerKey: 'LEAP-OWNER-KEY-2024'
                };

                if (
                    credentials.username === OWNER_CREDENTIALS.username &&
                    credentials.password === OWNER_CREDENTIALS.password &&
                    credentials.ownerKey === OWNER_CREDENTIALS.ownerKey
                ) {
                    const authToken = btoa(`${Date.now()}-${Math.random()}-owner`);
                    sessionStorage.setItem('ownerAuthToken', authToken);
                    sessionStorage.setItem('ownerAuthTime', Date.now().toString());
                    
                    setIsAuthenticated(true);
                    await loadData();
                } else {
                    setError('Invalid owner credentials. Access denied.');
                }
                setLoading(false);
            };

            const handleLogout = () => {
                sessionStorage.removeItem('ownerAuthToken');
                sessionStorage.removeItem('ownerAuthTime');
                setIsAuthenticated(false);
                setCredentials({ username: '', password: '', ownerKey: '' });
            };

            const toggleCourseStatus = async (courseId, currentStatus) => {
                const newStatus = currentStatus === 'Published' ? 'Draft' : 'Published';
                try {
                    await axios.put('/api/learning', {
                        type: 'course',
                        id: courseId,
                        updates: { status: newStatus }
                    });
                    await loadData();
                    alert(`Course ${newStatus.toLowerCase()} successfully!`);
                } catch (error) {
                    console.error('Failed to update course:', error);
                    // Update local state as fallback
                    setLearningContent(prev => ({
                        ...prev,
                        courses: prev.courses.map(course => 
                            course.id === courseId 
                                ? { ...course, status: newStatus }
                                : course
                        )
                    }));
                    alert(`Course ${newStatus.toLowerCase()} successfully!`);
                }
            };

            const deleteCourse = async (courseId) => {
                if (!confirm('Are you sure you want to delete this course?')) return;
                
                try {
                    await axios.delete(`/api/learning?type=course&id=${courseId}`);
                    await loadData();
                    alert('Course deleted successfully!');
                } catch (error) {
                    console.error('Failed to delete course:', error);
                    // Update local state as fallback
                    setLearningContent(prev => ({
                        ...prev,
                        courses: prev.courses.filter(course => course.id !== courseId)
                    }));
                    alert('Course deleted successfully!');
                }
            };

            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-slate-900 text-white flex items-center justify-center">
                        <div className="bg-slate-800 p-8 rounded-lg shadow-xl w-full max-w-md">
                            <div className="text-center mb-6">
                                <div className="text-4xl mb-2">üëë</div>
                                <h2 className="text-2xl font-bold text-white">Full Admin Panel</h2>
                                <p className="text-gray-400">Complete system management</p>
                            </div>

                            <form onSubmit={handleLogin}>
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-300 mb-2">
                                        Owner Username
                                    </label>
                                    <input
                                        type="text"
                                        value={credentials.username}
                                        onChange={(e) => setCredentials({...credentials, username: e.target.value})}
                                        className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500"
                                        placeholder="Enter owner username"
                                        required
                                    />
                                </div>

                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-300 mb-2">
                                        Owner Password
                                    </label>
                                    <input
                                        type="password"
                                        value={credentials.password}
                                        onChange={(e) => setCredentials({...credentials, password: e.target.value})}
                                        className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500"
                                        placeholder="Enter owner password"
                                        required
                                    />
                                </div>

                                <div className="mb-6">
                                    <label className="block text-sm font-medium text-gray-300 mb-2">
                                        Owner Key
                                    </label>
                                    <input
                                        type="password"
                                        value={credentials.ownerKey}
                                        onChange={(e) => setCredentials({...credentials, ownerKey: e.target.value})}
                                        className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500"
                                        placeholder="Enter owner key"
                                        required
                                    />
                                </div>

                                {error && (
                                    <div className="mb-4 p-3 bg-red-900 border border-red-700 rounded-lg text-red-300 text-sm">
                                        {error}
                                    </div>
                                )}

                                <div className="flex gap-3">
                                    <button
                                        type="submit"
                                        disabled={loading}
                                        className="flex-1 bg-orange-600 hover:bg-orange-700 disabled:bg-orange-800 text-white py-3 rounded-lg font-semibold transition-colors"
                                    >
                                        {loading ? 'Verifying...' : 'Access Admin Panel'}
                                    </button>
                                    <button
                                        type="button"
                                        onClick={() => window.location.href = '/'}
                                        className="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors"
                                    >
                                        Back to Website
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-900 text-white">
                    {/* Header */}
                    <div className="bg-gradient-to-r from-orange-600 to-red-600 text-white px-4 py-2 text-center">
                        üëë FULL ADMIN PANEL: Complete system management access
                    </div>

                    <div className="max-w-7xl mx-auto p-6">
                        <div className="flex items-center justify-between mb-6">
                            <div>
                                <h1 className="text-3xl font-bold text-blue-400 flex items-center">
                                    üëë Full Admin Panel
                                </h1>
                                <p className="text-gray-400">Complete system management and monitoring</p>
                            </div>
                            <div className="flex gap-3">
                                <button
                                    onClick={() => window.location.href = '/'}
                                    className="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors"
                                >
                                    üè† Back to Website
                                </button>
                                <button
                                    onClick={handleLogout}
                                    className="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition-colors"
                                >
                                    üö™ Logout
                                </button>
                            </div>
                        </div>

                        {/* Tab Navigation */}
                        <div className="flex gap-4 mb-6 border-b border-gray-700">
                            {['overview', 'learning', 'users'].map(tab => (
                                <button
                                    key={tab}
                                    onClick={() => setActiveTab(tab)}
                                    className={`px-4 py-2 font-semibold capitalize ${
                                        activeTab === tab
                                            ? 'text-blue-400 border-b-2 border-blue-400'
                                            : 'text-gray-400 hover:text-white'
                                    }`}
                                >
                                    {tab}
                                </button>
                            ))}
                        </div>

                        {/* Overview Tab */}
                        {activeTab === 'overview' && (
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                                <div className="bg-gray-800 p-6 rounded-lg">
                                    <div className="flex items-center space-x-3 mb-2">
                                        <div className="bg-blue-600 p-2 rounded">üìö</div>
                                        <div>
                                            <p className="text-gray-400 text-sm">TOTAL COURSES</p>
                                            <p className="text-2xl font-bold">{learningContent.courses.length}</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-gray-800 p-6 rounded-lg">
                                    <div className="flex items-center space-x-3 mb-2">
                                        <div className="bg-green-600 p-2 rounded">üë•</div>
                                        <div>
                                            <p className="text-gray-400 text-sm">TOTAL USERS</p>
                                            <p className="text-2xl font-bold">{users.length}</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-gray-800 p-6 rounded-lg">
                                    <div className="flex items-center space-x-3 mb-2">
                                        <div className="bg-purple-600 p-2 rounded">üé•</div>
                                        <div>
                                            <p className="text-gray-400 text-sm">TOTAL VIDEOS</p>
                                            <p className="text-2xl font-bold">{learningContent.videos.length}</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-gray-800 p-6 rounded-lg">
                                    <div className="flex items-center space-x-3 mb-2">
                                        <div className="bg-yellow-600 p-2 rounded">üìÑ</div>
                                        <div>
                                            <p className="text-gray-400 text-sm">RESOURCES</p>
                                            <p className="text-2xl font-bold">{learningContent.resources.length}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Learning Content Tab */}
                        {activeTab === 'learning' && (
                            <div className="bg-gray-800 rounded-lg p-6">
                                <h2 className="text-xl font-bold mb-4">üìö Learning Content Management</h2>
                                
                                <div className="space-y-4">
                                    {learningContent.courses.map(course => (
                                        <div key={course.id} className="bg-gray-700 p-4 rounded-lg flex items-center justify-between">
                                            <div>
                                                <h3 className="font-semibold text-lg">{course.title}</h3>
                                                <p className="text-gray-400 text-sm">{course.description}</p>
                                                <div className="flex gap-4 mt-2 text-sm text-gray-300">
                                                    <span>Status: <span className={course.status === 'Published' ? 'text-green-400' : 'text-yellow-400'}>{course.status}</span></span>
                                                    <span>Students: {course.students}</span>
                                                    <span>Lessons: {course.lessons}</span>
                                                    <span>Duration: {course.duration}</span>
                                                </div>
                                            </div>
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={() => toggleCourseStatus(course.id, course.status)}
                                                    className={`px-3 py-1 rounded text-sm font-semibold ${
                                                        course.status === 'Published'
                                                            ? 'bg-yellow-600 hover:bg-yellow-700'
                                                            : 'bg-green-600 hover:bg-green-700'
                                                    }`}
                                                >
                                                    {course.status === 'Published' ? 'Unpublish' : 'Publish'}
                                                </button>
                                                <button
                                                    onClick={() => deleteCourse(course.id)}
                                                    className="px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm font-semibold"
                                                >
                                                    Delete
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Users Tab */}
                        {activeTab === 'users' && (
                            <div className="bg-gray-800 rounded-lg p-6">
                                <h2 className="text-xl font-bold mb-4">üë• User Management</h2>
                                
                                <div className="overflow-x-auto">
                                    <table className="w-full text-left">
                                        <thead>
                                            <tr className="border-b border-gray-700">
                                                <th className="pb-3 text-gray-400">ID</th>
                                                <th className="pb-3 text-gray-400">Name</th>
                                                <th className="pb-3 text-gray-400">Email</th>
                                                <th className="pb-3 text-gray-400">Registered</th>
                                                <th className="pb-3 text-gray-400">Last Login</th>
                                                <th className="pb-3 text-gray-400">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {users.map(user => (
                                                <tr key={user.id} className="border-b border-gray-700">
                                                    <td className="py-3 text-gray-300">#{user.id}</td>
                                                    <td className="py-3 text-white font-medium">{user.name}</td>
                                                    <td className="py-3 text-gray-300">{user.email}</td>
                                                    <td className="py-3 text-gray-300">{user.createdAt}</td>
                                                    <td className="py-3 text-gray-300">{user.lastLogin}</td>
                                                    <td className="py-3">
                                                        <span className="bg-green-900 text-green-300 px-2 py-1 rounded text-sm">
                                                            Active
                                                        </span>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<FullAdminPanel />, document.getElementById('admin-root'));
    </script>
</body>
</html>